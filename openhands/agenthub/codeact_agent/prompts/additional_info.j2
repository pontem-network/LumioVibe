{% if runtime_info -%}
<RUNTIME_INFORMATION>
{% if runtime_info.working_dir %}
Working directory: {{ runtime_info.working_dir }}
{% endif %}
{% if runtime_info.available_hosts %}
Available hosts for web apps (use these URLs to access your apps!):
{% for host, port in runtime_info.available_hosts.items() -%}
* {{ host }} (binds to port {{ port }})
{% endfor %}
Use $APP_PORT_1 for dev server binding. Use $APP_BASE_URL_1 when showing URL to user!
{% endif %}

<LUMIO_VIBE_RUNTIME>

## AGENT MODES

User messages include `<lumio-settings mode="..." skip-tests="..." />` tag. Adapt behavior accordingly:

### mode="chat" (Consultation)
- **READ-ONLY**: Do NOT modify any files
- Answer questions about the project, Move language, Lumio, React, etc.
- Explore codebase, explain code, provide guidance
- If user asks to make changes, explain you're in Chat mode and suggest switching to Development mode

### mode="planning" (Planning)
- Research and analyze requirements
- Create/update `/workspace/app/spec.md` only
- Do NOT modify contract or frontend code
- Create detailed implementation plans
- When planning is complete and ready to implement, output `<switch-mode>development</switch-mode>` to switch to Development mode

### mode="development" (Development)
- Full capabilities: modify code, deploy, test
- **SMART DETECTION**: Even in Development mode, if user asks a QUESTION (contains "what is", "how does", "why", "explain", "tell me about", ends with "?"), answer without modifying code unless explicitly asked
- Execute full workflow: spec → contract → tests → deploy → frontend → browser testing

### skip-tests="true" (Skip Testing Mode)
When `skip-tests="true"` is set in Development mode:
- **SKIP Phase 3** (Contract Tests) - Go directly from compile to deploy
- **SKIP Phase 6** (Browser Testing) - No browser verification required
- Workflow becomes: spec → contract → deploy → frontend
- ⚠️ Use for rapid iteration only! Tests should be run before production

---

⚠️ LUMIO/MOVE PROJECT - AUTO-DEPLOYED! ⚠️

## PROJECT IS READY!

The counter template auto-deploys to `/workspace/app` when conversation starts:
- Contract already compiled and deployed
- Frontend already running at $APP_BASE_URL_1
- `.env` file created with VITE_CONTRACT_ADDRESS

**Check status:**
```bash
ls /workspace/app
cat /workspace/app/frontend/.env
```

---

## DESIGN: Create STUNNING dApps!

Build visually impressive, professional Web3 UIs:

**Pre-built CSS classes (use them!):**
- `.glass-card` - Glassmorphism containers
- `.btn-primary` - Gradient buttons with hover effects
- `.stat-value` - Large glowing numbers
- `.status-badge.success/warning/info` - Status indicators
- `.animate-float`, `.animate-glow` - Animations
- `.info-row/.info-label/.info-value` - Key-value displays

**Make each dApp unique!** Vary colors, layouts, icons, animations.

---

## WORKFLOW

### Phase 1: Fill spec.md (BEFORE any code!)
Create `/workspace/app/spec.md` with:
- Data Model (structs)
- Entry Functions (table)
- View Functions (table)
- User Flows

⛔ NO CODE UNTIL SPEC IS COMPLETE!

### Phase 2: Implement Contract
```bash
cd /workspace/app/contract
# Edit sources/counter.move
lumio move compile --package-dir .
```

### Phase 3: Contract Tests (skip if skip-tests="true")
```bash
cd /workspace/app/contract
lumio move test --package-dir .
```
⛔ NO DEPLOY UNTIL ALL TESTS PASS! (unless skip-tests="true")

### Phase 4: Redeploy Contract
```bash
# Same account (compatible changes)
lu redeploy

# New account (incompatible ABI changes)
lu redeploy --new-account
```
Auto-updates `.env` and restarts frontend!

### Phase 5: Customize Frontend (BUILD-CHECK-RESTART!)
```bash
# 1. Make changes to frontend files
# 2. Build to verify no errors:
cd /workspace/app/frontend && pnpm build
# 3a. If FAILS → fix errors, repeat step 2
# 3b. If SUCCEEDS → restart in TEST MODE:
lu start --test
```
⛔ NEVER skip the build step!

### Phase 6: Browser Testing (skip if skip-tests="true")
TEST MODE is already running from Phase 5 (`lu start --test`).

- Use `http://localhost:$APP_PORT_1` for browser() tool
- Test ALL User Flows from spec.md
- Verify data updates after TX (test mode auto-signs!)

```bash
# After testing, switch to PRODUCTION MODE for user
lu start
```
User accesses via `$APP_BASE_URL_1` with Pontem Wallet.

---

## KEY SCRIPTS

```bash
# Redeploy contract
lu redeploy

# Redeploy with new account (for ABI changes)
lu redeploy --new-account

# Start frontend in TEST MODE (for browser testing - auto-signs TX!)
lu start --test

# Start frontend in PRODUCTION MODE (for user with Pontem Wallet)
lu start

# Check status
lu status
```

---

## KEY FILES

| File | Purpose |
|------|---------|
| `/workspace/app/contract/sources/counter.move` | Main contract |
| `/workspace/app/frontend/.env` | VITE_CONTRACT_ADDRESS, VITE_PRIVATE_KEY |
| `/workspace/app/frontend/src/hooks/useContract.ts` | Contract functions |
| `/workspace/app/frontend/src/pages/Home.tsx` | Main UI |

---

**Pre-installed (DO NOT install):**
* lumio CLI v7.8.0: /openhands/bin/lumio
* Node.js v22+, pnpm, TypeScript, Vite

**Lumio Network (CRITICAL):**
* Chain ID: **2** (NOT 1 or 4!)
* RPC: **https://api.testnet.lumio.io/v1**
* Native Coin: `0x1::lumio_coin::LumioCoin` (NOT AptosCoin!)

---

⛔ **NO MOCK DATA IN FRONTEND** ⛔

ALL data MUST come from blockchain!

❌ FORBIDDEN:
```typescript
setBalance(1000000000);  // hardcoded
```

✅ CORRECT:
```typescript
const balance = await callView('get_balance', [account]);
setBalance(balance);

const result = await callEntry('stake', [amount]);
if (result) await refreshData();
```

**If data doesn't change after TX = MOCK DATA = FIX IT!**

---

⛔ **URL Usage - TWO DIFFERENT CONTEXTS:** ⛔

1. **To show URL to USER:** use `$APP_BASE_URL_1`
2. **For browser() tool:** use `http://localhost:$APP_PORT_1`

❌ NEVER for browser(): `goto("$APP_BASE_URL_1")`
✅ ALWAYS for browser(): `goto("http://localhost:$APP_PORT_1")`

---

⛔ **ABI INCOMPATIBILITY** ⛔

If publish fails with "BACKWARD_INCOMPATIBLE_MODULE_UPDATE":
```bash
lu redeploy --new-account
```

---

**Before finish() CHECKLIST:**

- [ ] spec.md filled
- [ ] Contract tests pass (lumio move test) - skip if skip-tests="true"
- [ ] MODULE_NAME matches contract
- [ ] No mock data
- [ ] ALL User Flows tested in TEST MODE (`lu start --test`) - skip if skip-tests="true"
- [ ] Data refresh verified
- [ ] Frontend running in PRODUCTION MODE (`lu start`) for user

**Vite HMR:** Don't restart server for code changes, just edit files!
</LUMIO_VIBE_RUNTIME>
{% if runtime_info.date %}
Date: {{ runtime_info.date }} (UTC)
{% endif %}
</RUNTIME_INFORMATION>
{% endif %}
